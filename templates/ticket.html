<!doctype html>
<html>
<head>
    <meta charset="utf-8" />
    <title>{{ ticket.title }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <style>
    .log-section {
        margin-top: 30px;
        background: white;
        padding: 20px;
        border-radius: 5px;
    }
    
    .log-filters {
        margin-bottom: 20px;
        padding: 10px;
        background: #f8f9fa;
        border-radius: 5px;
    }
    
    .log-filters a {
        display: inline-block;
        margin-right: 10px;
        padding: 5px 15px;
        background: #e9ecef;
        border-radius: 3px;
        text-decoration: none;
    }
    
    .log-filters a:hover {
        background: #dee2e6;
    }
    
    .log-filters a.active {
        background: #0066cc;
        color: white;
    }
    
    .log-entry {
        font-family: 'Courier New', monospace;
        font-size: 13px;
        padding: 8px;
        border-left: 3px solid #ccc;
        margin-bottom: 5px;
        background: #f8f9fa;
    }
    
    .log-entry.ERROR {
        border-left-color: #dc3545;
        background: #fff5f5;
    }
    
    .log-entry.WARN {
        border-left-color: #ffc107;
        background: #fffef5;
    }
    
    .log-entry.INFO {
        border-left-color: #28a745;
    }
    
    .log-level {
        font-weight: bold;
        margin-right: 10px;
    }
    
    .log-level.ERROR { color: #dc3545; }
    .log-level.WARN { color: #ffc107; }
    .log-level.INFO { color: #28a745; }
    
    .log-timestamp {
        color: #6c757d;
        margin-right: 10px;
    }
    
    .issues-container {
        margin-bottom: 20px;
    }
    
    .issue-card {
        padding: 12px;
        margin: 8px 0;
        border-radius: 5px;
        border-left: 4px solid;
    }
    
    .issue-card.severity-critical {
        background: #fee;
        border-left-color: #dc3545;
    }
    
    .issue-card.severity-high {
        background: #fff3cd;
        border-left-color: #ffc107;
    }
    
    .issue-card.severity-medium {
        background: #d1ecf1;
        border-left-color: #17a2b8;
    }
    
    .issue-severity {
        display: inline-block;
        background: #333;
        color: white;
        padding: 2px 8px;
        border-radius: 3px;
        font-size: 11px;
        font-weight: bold;
        margin-right: 8px;
    }
</style>
</head>
<body>
    <p><a href="/">‚Üê Back to tickets</a></p>

    <h1>{{ ticket.title }}</h1>
    <p><strong>Severity:</strong> {{ ticket.severity }}</p>
    <p><strong>Symptoms:</strong> {{ ticket.symptoms }}</p>
    <p><strong>Steps to reproduce:</strong> {{ ticket.steps_to_reproduce }}</p>
    <p><strong>Environment:</strong> {{ ticket.environment }}</p>

    <!-- Metrics Section -->
    {% if metrics %}
    <div class="log-section">
        <h2>Performance Metrics</h2>
        
        <!-- Auto-detected Issues -->
        {% if issues %}
        <div class="issues-container">
            <h3>üö® Auto-Detected Issues</h3>
            {% for issue in issues %}
            <div class="issue-card severity-{{ issue.severity }}">
                <span class="issue-severity">{{ issue.severity|upper }}</span>
                <strong>{{ issue.component }}</strong>: {{ issue.issue }}
            </div>
            {% endfor %}
        </div>
        {% endif %}
        
        <!-- Raw Metrics Display -->
        <details>
            <summary style="cursor: pointer; font-weight: bold; margin-top: 20px;">üìä View Raw Metrics</summary>
            <pre style="background: #f8f9fa; padding: 15px; border-radius: 5px; overflow-x: auto;">{{ metrics | tojson(indent=2) }}</pre>
        </details>
    </div>
    {% endif %}

    <!-- Log Viewer Section -->
    <div class="log-section">
        <h2>Application Logs</h2>
        
        <div class="log-filters">
            <strong>Filter by level:</strong>
            <a href="/tickets/{{ ticket.id }}" class="{% if not current_filter %}active{% endif %}">All</a>
            <a href="/tickets/{{ ticket.id }}?level=ERROR" class="{% if current_filter == 'ERROR' %}active{% endif %}">ERROR</a>
            <a href="/tickets/{{ ticket.id }}?level=WARN" class="{% if current_filter == 'WARN' %}active{% endif %}">WARN</a>
            <a href="/tickets/{{ ticket.id }}?level=INFO" class="{% if current_filter == 'INFO' %}active{% endif %}">INFO</a>
        </div>

        {% if logs %}
            <div class="log-container">
                {% for log in logs %}
                <div class="log-entry {{ log.level }}">
                    <span class="log-timestamp">{{ log.timestamp }}</span>
                    <span class="log-level {{ log.level }}">{{ log.level }}</span>
                    <span class="log-message">{{ log.message }}</span>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p style="color: #6c757d; font-style: italic;">No logs available for this ticket.</p>
        {% endif %}
    </div>
</body>
</html>